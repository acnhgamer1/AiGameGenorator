<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🧠 AI Project Generator</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-primary: #0f0f0f;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #252525;
      --bg-card: #2d2d2d;
      --text-primary: #ffffff;
      --text-secondary: #b8b8b8;
      --text-muted: #888;
      --accent: #00d4ff;
      --accent-hover: #00b8e6;
      --accent-glow: rgba(0, 212, 255, 0.3);
      --error: #ff4757;
      --warning: #ffa502;
      --success: #2ed573;
      --info: #5352ed;
      --border: #404040;
      --shadow: rgba(0, 0, 0, 0.3);
      --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    [data-theme="light"] {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #e9ecef;
      --bg-card: #ffffff;
      --text-primary: #212529;
      --text-secondary: #495057;
      --text-muted: #6c757d;
      --accent: #007bff;
      --accent-hover: #0056b3;
      --accent-glow: rgba(0, 123, 255, 0.2);
      --border: #dee2e6;
      --shadow: rgba(0, 0, 0, 0.1);
      --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      transition: all 0.3s ease;
      line-height: 1.6;
      overflow: hidden;
    }

    header {
      padding: 0.8rem 1.5rem;
      background: var(--bg-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px var(--shadow);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .header-title {
      font-size: 1.8rem;
      font-weight: 700;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .theme-toggle {
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 10px 16px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px var(--shadow);
    }

    .theme-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px var(--shadow);
    }

    #controls {
      display: flex;
      gap: 10px;
      padding: 0.8rem 1.5rem;
      background: var(--bg-tertiary);
      align-items: center;
      flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(10px);
      flex-shrink: 0;
    }

    #promptInput {
      flex: 1;
      min-width: 300px;
      padding: 15px 20px;
      border: 2px solid var(--border);
      border-radius: 30px;
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 1.1rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px var(--shadow);
    }

    #promptInput:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
      transform: translateY(-1px);
    }

    #promptInput::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      background: var(--accent);
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
      box-shadow: 0 4px 15px var(--accent-glow);
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover:not(:disabled) {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 25px var(--accent-glow);
    }

    button:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .secondary-btn {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 2px solid var(--border);
      box-shadow: 0 2px 10px var(--shadow);
    }

    .secondary-btn:hover:not(:disabled) {
      background: var(--border);
      border-color: var(--accent);
    }

    #status {
      text-align: center;
      padding: 8px;
      font-size: 0.9rem;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
      font-weight: 500;
      flex-shrink: 0;
    }

    #mainContent {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    #sidebar {
      width: 320px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      overflow-y: auto;
      transition: transform 0.3s ease;
      box-shadow: 4px 0 20px var(--shadow);
      flex-shrink: 0;
      height: 100%;
    }

    #sidebar.collapsed {
      transform: translateX(-100%);
      width: 0;
    }

    .sidebar-section {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-title {
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--accent);
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .favorite-item {
      padding: 15px 18px;
      margin: 8px 0;
      background: var(--bg-card);
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--border);
      box-shadow: 0 2px 10px var(--shadow);
    }

    .favorite-item:hover {
      background: var(--bg-tertiary);
      transform: translateX(8px);
      box-shadow: 0 4px 20px var(--shadow);
    }

    .favorite-desc {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    #gameContainer {
      flex: 1;
      margin: 10px;
      overflow: hidden;
      border-radius: 15px;
      box-shadow: 0 10px 40px var(--shadow);
      background: var(--bg-primary);
      position: relative;
      border: 1px solid var(--border);
      min-height: 0;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 20px;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .toggle-container select,
    .toggle-container input[type="checkbox"] {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      font-size: 1rem;
      accent-color: var(--accent);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .toggle-container select:focus,
    .toggle-container input[type="checkbox"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .actions {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: var(--bg-secondary);
      padding: 2.5rem;
      border-radius: 20px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 1px solid var(--border);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent);
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      color: var(--text-muted);
      padding: 0;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .close-btn:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .favorite-btn {
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      color: var(--text-muted);
      padding: 8px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .favorite-btn:hover {
      color: var(--warning);
      background: var(--bg-card);
      transform: scale(1.1);
    }

    .favorite-btn.active {
      color: var(--warning);
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--bg-card);
      border-radius: 3px;
      overflow: hidden;
      margin: 15px 0;
      box-shadow: inset 0 2px 4px var(--shadow);
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 3px;
      box-shadow: 0 0 10px var(--accent-glow);
    }

    .stats-container {
      display: flex;
      gap: 20px;
      margin: 15px 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid var(--border);
    }

    .version-history {
      max-height: 300px;
      overflow-y: auto;
    }

    .version-item {
      padding: 15px;
      margin: 8px 0;
      background: var(--bg-card);
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      border: 1px solid var(--border);
    }

    .version-item:hover {
      background: var(--bg-tertiary);
      transform: translateX(8px);
    }

    .version-time {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .keyboard-shortcuts {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: 15px;
      font-size: 0.9rem;
      color: var(--text-muted);
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      max-width: 300px;
      display: none;
      border: 1px solid var(--border);
    }

    .shortcut-item {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
    }

    .shortcut-key {
      background: var(--bg-card);
      padding: 4px 10px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-weight: 600;
      color: var(--accent);
    }

    @media (max-width: 768px) {
      #sidebar {
        position: absolute;
        height: 100%;
        z-index: 100;
        width: 280px;
      }
      
      .header-controls {
        flex-wrap: wrap;
        gap: 8px;
      }
      
      #controls {
        flex-direction: column;
        align-items: stretch;
        padding: 0.6rem 1rem;
      }
      
      .actions {
        justify-content: center;
      }

      #promptInput {
        min-width: 200px;
      }

      #gameContainer {
        margin: 8px;
      }

      .header-title {
        font-size: 1.4rem;
      }

      button {
        padding: 10px 18px;
        font-size: 0.9rem;
      }
    }

    @media (max-width: 480px) {
      header {
        padding: 0.6rem 1rem;
      }
      
      #controls {
        padding: 0.5rem 0.8rem;
      }
      
      #sidebar {
        width: 260px;
      }
      
      .header-title {
        font-size: 1.2rem;
      }
      
      #promptInput {
        font-size: 1rem;
        padding: 12px 16px;
      }
      
      button {
        padding: 8px 16px;
        font-size: 0.85rem;
      }
    }

    .preview-modes {
      display: flex;
      gap: 6px;
      margin: 10px;
      position: absolute;
      top: 0;
      right: 0;
      z-index: 10;
    }

    .preview-btn {
      padding: 8px 12px;
      font-size: 0.8rem;
      background: var(--bg-card);
      color: var(--text-primary);
      border: 2px solid var(--border);
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .preview-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    .share-link {
      display: flex;
      gap: 15px;
      align-items: center;
      margin: 15px 0;
    }

    .share-input {
      flex: 1;
      padding: 12px;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 1rem;
    }

    .notification {
      position: fixed;
      top: 30px;
      right: 30px;
      padding: 15px 25px;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      z-index: 1001;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: var(--success);
    }

    .notification.error {
      background: var(--error);
    }

    .notification.info {
      background: var(--info);
    }

    .generation-tips {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 15px;
      padding: 20px;
      margin: 10px 0;
    }

    .tip-title {
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .tip-list {
      list-style: none;
      padding: 0;
    }

    .tip-list li {
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
      color: var(--text-secondary);
    }

    .tip-list li:last-child {
      border-bottom: none;
    }

    .tip-list li::before {
      content: "💡 ";
      margin-right: 8px;
    }

    .loading-animation {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .quality-indicators {
      display: flex;
      gap: 10px;
      margin: 10px 0;
      flex-wrap: wrap;
    }

    .quality-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .quality-badge.high {
      background: var(--success);
      color: white;
    }

    .quality-badge.medium {
      background: var(--warning);
      color: white;
    }

    .quality-badge.basic {
      background: var(--info);
      color: white;
    }

    .suggestion-btn {
      background: var(--bg-card);
      border: 2px solid var(--border);
      color: var(--text-primary);
      padding: 12px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
      text-align: left;
      font-weight: 500;
    }

    .suggestion-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      transform: translateX(5px);
    }

    .project-card {
      transition: all 0.3s ease;
    }

    .project-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--shadow);
      border-color: var(--accent);
    }

    .import-export-section {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .bulk-action-btn {
      padding: 8px 16px;
      font-size: 0.9rem;
      border-radius: 8px;
      border: 2px solid var(--border);
      background: var(--bg-card);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .bulk-action-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin: 10px 0;
    }

    .enhanced-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 0.9rem;
    }

    .stat-value {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--accent);
    }
  </style>
</head>

<body data-theme="dark">

  <header>
    <div class="header-title">🧠 AI Project Generator</div>
    <div class="header-controls">
      <button class="theme-toggle secondary-btn" onclick="toggleTheme()">🌙</button>
      <button class="secondary-btn" onclick="toggleSidebar()">💡 Ideas</button>
      <button class="secondary-btn" onclick="showModal('historyModal')">📝 History</button>
    </div>
  </header>

  <div id="controls">
    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; width: 100%;">
      <input id="promptInput" placeholder="What do you want to create? (e.g., snake game, calculator, todo list)" style="flex: 1; min-width: 300px;" />
      
      <div class="toggle-container">
        <label for="modeSelect">I want a:</label>
        <select id="modeSelect">
          <option value="game">🎮 Game</option>
          <option value="website">🌐 Website</option>
          <option value="app">📱 App</option>
          <option value="tool">🔧 Tool</option>
        </select>
      </div>

      <button id="generateBtn" style="padding: 15px 30px; font-size: 1.1rem; font-weight: 700;">✨ Create It!</button>
    </div>

    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; margin-top: 15px; justify-content: center;">
      <div class="toggle-container">
        <label for="creativitySelect">Creativity Level:</label>
        <select id="creativitySelect">
          <option value="typical">🎯 Typical & Polished</option>
          <option value="creative" selected>🎨 Creative & Unique</option>
          <option value="innovative">🚀 Completely Original</option>
          <option value="experimental">🔬 Experimental & Wild</option>
        </select>
      </div>

      <div class="toggle-container">
        <input type="checkbox" id="includeAI" />
        <label for="includeAI">🤖 Add AI Features</label>
      </div>

      <button id="downloadBtn" class="secondary-btn" disabled>📥 Download</button>
      <button id="resetBtn" class="secondary-btn" disabled>🔄 Try Again</button>
    </div>
  </div>

  <div id="status">Ready to create something amazing! 🚀</div>
  
  <div class="progress-bar" id="progressBar" style="display: none;">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <div id="mainContent">
    <div id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">💡 Project Ideas</div>
        <div class="generation-tips">
          <div class="tip-title">Popular Creations:</div>
          <div style="display: flex; flex-direction: column; gap: 8px;">
            <button class="suggestion-btn" onclick="setSuggestion('3D snake game with neon graphics and particle effects')">🐍 3D Snake Game</button>
            <button class="suggestion-btn" onclick="setSuggestion('glassmorphism calculator with smooth animations')">🧮 Glass Calculator</button>
            <button class="suggestion-btn" onclick="setSuggestion('todo app with stunning animations and dark mode')">📝 Todo App Pro</button>
            <button class="suggestion-btn" onclick="setSuggestion('memory game with beautiful card flip animations')">🃏 Memory Cards</button>
            <button class="suggestion-btn" onclick="setSuggestion('drawing app with brush effects and gradient tools')">🎨 Art Studio</button>
            <button class="suggestion-btn" onclick="setSuggestion('interactive quiz with progress bars and confetti')">❓ Quiz Master</button>
            <button class="suggestion-btn" onclick="setSuggestion('AI chatbot with typing animations and bubble effects')">🤖 Smart Assistant</button>
            <button class="suggestion-btn" onclick="setSuggestion('weather app with animated backgrounds and icons')">🌤️ Weather Pro</button>
            <button class="suggestion-btn" onclick="setSuggestion('music player with visualizations and waveforms')">🎵 Music Player</button>
            <button class="suggestion-btn" onclick="setSuggestion('portfolio website with 3D animations and parallax')">💼 Portfolio Site</button>
          </div>
        </div>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-title">💾 My Projects</div>
        <div id="savedProjectsList">
          <div style="color: var(--text-muted); font-size: 1rem; padding: 20px; text-align: center;">No projects saved yet<br><span style="font-size: 0.9rem;">Save your creations to manage them!</span></div>
        </div>
        <div style="text-align: center; margin-top: 15px;">
          <button id="saveProjectBtn" class="secondary-btn" title="Save Current Project" disabled>💾 Save Project</button>
          <button id="loadProjectBtn" class="secondary-btn" style="margin-top: 8px; width: 100%;">📂 Load Project</button>
          <button id="shareBtn" class="secondary-btn" disabled style="margin-top: 8px; width: 100%;">🔗 Share Creation</button>
        </div>
      </div>

      

      <div class="sidebar-section">
        <div class="sidebar-title">⭐ Favorites</div>
        <div id="favoritesList">
          <div style="color: var(--text-muted); font-size: 1rem; padding: 20px; text-align: center;">No favorites yet<br><span style="font-size: 0.9rem;">Star your best creations!</span></div>
        </div>
        <div style="text-align: center; margin-top: 15px;">
          <button id="favoriteBtn" class="secondary-btn" title="Add to Favorites" disabled>⭐ Add Favorite</button>
        </div>
      </div>
    </div>

    <div id="gameContainer">
      <div class="preview-modes">
        <button class="preview-btn active" data-size="desktop" title="Desktop View">🖥️</button>
        <button class="preview-btn" data-size="tablet" title="Tablet View">📱</button>
        <button class="preview-btn" data-size="mobile" title="Mobile View">📱</button>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">📝 Generation History</div>
        <button class="close-btn" onclick="closeModal('historyModal')">&times;</button>
      </div>
      <div class="version-history" id="versionHistory">
        <div style="color: var(--text-muted); padding: 30px; text-align: center; font-size: 1.1rem;">No history yet<br><span style="font-size: 0.9rem;">Your generated projects will appear here</span></div>
      </div>
    </div>
  </div>

  <div id="shareModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">🔗 Share Project</div>
        <button class="close-btn" onclick="closeModal('shareModal')">&times;</button>
      </div>
      <div class="share-link">
        <input type="text" class="share-input" id="shareInput" readonly />
        <button onclick="copyShareLink()">📋 Copy</button>
      </div>
      <div class="quality-indicators" id="qualityIndicators"></div>
      <div style="margin-top: 20px;">
        <div class="stats-container" id="projectStats">
          <div class="stat-item">📝 <span id="codeLines">0</span> lines</div>
          <div class="stat-item">⚡ <span id="loadTime">0</span>ms</div>
          <div class="stat-item">📦 <span id="codeSize">0</span>KB</div>
        </div>
      </div>
    </div>
  </div>

  <div class="keyboard-shortcuts" id="shortcuts">
    <div style="font-weight: bold; margin-bottom: 15px; color: var(--accent);">⌨️ Keyboard Shortcuts</div>
    <div class="shortcut-item">
      <span>Generate</span>
      <span class="shortcut-key">Ctrl+Enter</span>
    </div>
    <div class="shortcut-item">
      <span>Reset</span>
      <span class="shortcut-key">Ctrl+R</span>
    </div>
    <div class="shortcut-item">
      <span>Download</span>
      <span class="shortcut-key">Ctrl+D</span>
    </div>
    <div class="shortcut-item">
      <span>Toggle Sidebar</span>
      <span class="shortcut-key">Ctrl+B</span>
    </div>
  </div>

  <!-- Project Management Modal -->
  <div id="projectModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">💾 Project Manager</div>
        <button class="close-btn" onclick="closeModal('projectModal')">&times;</button>
      </div>
      <div style="margin-bottom: 20px;">
        <input type="text" id="projectNameInput" placeholder="Enter project name..." style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; background: var(--bg-card); color: var(--text-primary); font-size: 1rem;" />
      </div>
      <div id="savedProjectsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; max-height: 400px; overflow-y: auto;">
        <!-- Saved projects will appear here -->
      </div>
      <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
        <button onclick="exportAllProjects()" class="secondary-btn">📤 Export All</button>
        <button onclick="importProjects()" class="secondary-btn">📥 Import</button>
        <button onclick="clearAllProjects()" class="secondary-btn" style="background: var(--error);">🗑️ Clear All</button>
      </div>
    </div>
  </div>

  <!-- Import File Input -->
  <input type="file" id="importFileInput" accept=".json" style="display: none;" />

  <div id="notification" class="notification"></div>

  <script>
    const promptInput = document.getElementById("promptInput");
    const generateBtn = document.getElementById("generateBtn");
    const resetBtn = document.getElementById("resetBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const shareBtn = document.getElementById("shareBtn");
    const favoriteBtn = document.getElementById("favoriteBtn");
    const historyBtn = document.getElementById("historyBtn");
    const gameContainer = document.getElementById("gameContainer");
    const status = document.getElementById("status");
    const includeAI = document.getElementById("includeAI");
    const modeSelect = document.getElementById("modeSelect");
    const creativitySelect = document.getElementById("creativitySelect");
    const progressBar = document.getElementById("progressBar");
    const progressFill = document.getElementById("progressFill");
    const sidebar = document.getElementById("sidebar");

    const AI_KEYWORDS = ['chatbot', 'ai npc', 'talking npc', 'assistant', 'conversation', 'talk to', 'text input', 'dialogue', 'interactive npc', 'ai character', 'smart', 'intelligent'];
    const CHATBOT_KEYWORDS = ['chatbot', 'chat bot', 'ai chat', 'conversation bot', 'talking bot', 'virtual assistant', 'ai assistant', 'chat assistant', 'dialogue system', 'conversational ai'];
    const INTERNET_KEYWORDS = ['internet', 'browse', 'online', 'web access', 'fetch data', 'api'];

    let lastGeneratedCode = null;
    let currentPrompt = null;
    let generationHistory = JSON.parse(localStorage.getItem('generationHistory')) || [];
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    let savedProjects = JSON.parse(localStorage.getItem('savedProjects')) || [];
    let currentPreviewSize = 'desktop';

    // Enhanced comment filtering function
    function filterCodeComments(code) {
      // Remove any text before the first HTML tag
      const htmlStart = code.indexOf('<!DOCTYPE html>') !== -1 ? code.indexOf('<!DOCTYPE html>') : 
                       code.indexOf('<html') !== -1 ? code.indexOf('<html') : 0;
      
      if (htmlStart > 0) {
        code = code.substring(htmlStart);
      }
      
      // Remove text after closing html tag
      const htmlEnd = code.lastIndexOf('</html>');
      if (htmlEnd !== -1) {
        code = code.substring(0, htmlEnd + 7);
      }
      
      // Remove HTML comments
      code = code.replace(/<!--[\s\S]*?-->/g, '');
      
      // Remove CSS comments
      code = code.replace(/\/\*[\s\S]*?\*\//g, '');
      
      // Remove JavaScript comments (single line)
      code = code.replace(/\/\/.*$/gm, '');
      
      // Remove JavaScript comments (multi-line) more carefully
      code = code.replace(/\/\*[\s\S]*?\*\//g, '');
      
      // Remove explanatory text that might appear before or after code
      const patterns = [
        /^[^<]*(?=<!DOCTYPE|<html)/i,  // Remove text before HTML
        /<\/html>[^<]*$/i,            // Remove text after closing HTML
        /```[\s\S]*?```/g,            // Remove code blocks
        /Here's.*?:/gi,               // Remove "Here's the code:"
        /This.*?creates?/gi,          // Remove explanations
        /The.*?code/gi,               // Remove "The code does..."
        /^[A-Za-z\s:,.-]*(?=<!DOCTYPE|<html)/m  // Remove leading explanations
      ];
      
      patterns.forEach(pattern => {
        code = code.replace(pattern, '');
      });
      
      return code.trim();
    }

    // Project Management Functions
    function saveCurrentProject() {
      if (!lastGeneratedCode || !currentPrompt) {
        showNotification('❌ No project to save', 'error');
        return;
      }
      
      const projectName = document.getElementById('projectNameInput').value.trim() || 
                         `${modeSelect.value}-${Date.now()}`;
      
      const project = {
        id: Date.now(),
        name: projectName,
        prompt: currentPrompt,
        code: lastGeneratedCode,
        mode: modeSelect.value,
        creativity: creativitySelect.value,
        includesAI: includeAI.checked,
        timestamp: Date.now(),
        size: Math.round(new Blob([lastGeneratedCode]).size / 1024),
        quality: analyzeComplexity(lastGeneratedCode)
      };
      
      // Check for duplicate names
      const existingIndex = savedProjects.findIndex(p => p.name === projectName);
      if (existingIndex > -1) {
        savedProjects[existingIndex] = project;
        showNotification('✅ Project updated', 'success');
      } else {
        savedProjects.push(project);
        showNotification('💾 Project saved successfully', 'success');
      }
      
      localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
      updateSavedProjectsDisplay();
      closeModal('projectModal');
    }

    function updateSavedProjectsDisplay() {
      const container = document.getElementById('savedProjectsList');
      const gridContainer = document.getElementById('savedProjectsGrid');
      
      if (savedProjects.length === 0) {
        container.innerHTML = '<div style="color: var(--text-muted); font-size: 1rem; padding: 20px; text-align: center;">No projects saved yet<br><span style="font-size: 0.9rem;">Save your creations to manage them!</span></div>';
        if (gridContainer) gridContainer.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: var(--text-muted); padding: 40px;">No saved projects</div>';
        return;
      }

      // Update sidebar list
      container.innerHTML = savedProjects.slice(0, 5).map((project, index) => `
        <div class="favorite-item" onclick="loadSavedProject(${project.id})">
          <div>
            <div style="font-weight: 600;">${project.name}</div>
            <div class="favorite-desc">${project.mode} • ${project.creativity} • ${project.size}KB</div>
            <div class="favorite-desc">${new Date(project.timestamp).toLocaleDateString()}</div>
          </div>
          <button class="favorite-btn" onclick="event.stopPropagation(); deleteProject(${project.id})" title="Delete">🗑️</button>
        </div>
      `).join('') + (savedProjects.length > 5 ? '<div style="text-align: center; margin-top: 10px; color: var(--text-muted); font-size: 0.9rem;">+ ' + (savedProjects.length - 5) + ' more in Project Manager</div>' : '');

      // Update modal grid
      if (gridContainer) {
        gridContainer.innerHTML = savedProjects.map(project => `
          <div class="project-card" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 15px; cursor: pointer; transition: all 0.3s ease;" onclick="loadSavedProject(${project.id})">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">${project.name}</div>
            <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 10px;">${project.prompt.substring(0, 60)}...</div>
            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--text-muted);">
              <span>${project.mode} • ${project.size}KB</span>
              <button onclick="event.stopPropagation(); deleteProject(${project.id})" style="background: var(--error); color: white; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer;">🗑️</button>
            </div>
          </div>
        `).join('');
      }
    }

    function loadSavedProject(projectId) {
      const project = savedProjects.find(p => p.id === projectId);
      if (!project) return;
      
      promptInput.value = project.prompt;
      modeSelect.value = project.mode;
      creativitySelect.value = project.creativity;
      includeAI.checked = project.includesAI;
      showGame(project.code);
      currentPrompt = project.prompt;
      
      closeModal('projectModal');
      showNotification('📂 Project loaded successfully', 'success');
    }

    function deleteProject(projectId) {
      if (confirm('Are you sure you want to delete this project?')) {
        savedProjects = savedProjects.filter(p => p.id !== projectId);
        localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
        updateSavedProjectsDisplay();
        showNotification('🗑️ Project deleted', 'info');
      }
    }

    // Template system - enhanced for amazing graphics and UX
    const projectTemplates = {
      '3d-snake': 'Create a 3D snake game with neon graphics, particle effects, smooth movement, food collection, score tracking, and stunning game over animations',
      'glass-calculator': 'Build a glassmorphism calculator with big buttons, frosted glass effects, smooth animations, and advanced arithmetic operations',
      'todo-pro': 'Design a premium todo list with stunning animations, dark mode, checkboxes with satisfying effects, local storage, and beautiful modern interface',
      'smart-assistant': 'Create an AI chatbot with personality using Pollinations AI, animated message bubbles, typing indicators, and smooth chat animations',
      'art-studio': 'Build an advanced drawing application with brush effects, gradient tools, multiple colors, canvas effects, and professional UI'
    };

    function loadTemplate(templateKey) {
      if (projectTemplates[templateKey]) {
        promptInput.value = projectTemplates[templateKey];
        promptInput.focus();
        showNotification('🎨 Template loaded! Click "Create It!" to generate', 'info');
      }
    }

    // Bulk operations
    function exportAllProjects() {
      if (savedProjects.length === 0) {
        showNotification('❌ No projects to export', 'error');
        return;
      }
      
      const exportData = {
        projects: savedProjects,
        exportDate: new Date().toISOString(),
        version: '1.0'
      };
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ai-projects-export-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification('📤 Projects exported successfully', 'success');
    }

    function importProjects() {
      document.getElementById('importFileInput').click();
    }

    function clearAllProjects() {
      if (confirm('Are you sure you want to delete ALL saved projects? This cannot be undone.')) {
        savedProjects = [];
        localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
        updateSavedProjectsDisplay();
        showNotification('🗑️ All projects cleared', 'info');
      }
    }

    // Enhanced prompt suggestions
    const promptSuggestions = [
      "Create a multiplayer snake game with power-ups, obstacles, and a leaderboard system",
      "Build a tower defense game with multiple enemy types, upgradeable towers, and wave progression",
      "Design a puzzle platformer with physics-based mechanics and collectible items",
      "Make a space shooter with different weapon types, enemy patterns, and boss battles",
      "Create a city builder game with resource management and population growth",
      "Build a racing game with multiple tracks, car customization, and time trials",
      "Design a RPG battle system with turn-based combat and character progression",
      "Make a music rhythm game with beat detection and visual effects",
      "Create a stock trading simulator with real-time charts and portfolio management",
      "Build a weather dashboard with interactive maps and forecasting"
    ];

    // Theme Management
    function toggleTheme() {
      const body = document.body;
      const themeBtn = document.querySelector('.theme-toggle');
      if (body.getAttribute('data-theme') === 'dark') {
        body.setAttribute('data-theme', 'light');
        themeBtn.textContent = '☀️';
        localStorage.setItem('theme', 'light');
      } else {
        body.setAttribute('data-theme', 'dark');
        themeBtn.textContent = '🌙';
        localStorage.setItem('theme', 'dark');
      }
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    document.querySelector('.theme-toggle').textContent = savedTheme === 'dark' ? '🌙' : '☀️';

    // Sidebar Management
    function toggleSidebar() {
      sidebar.classList.toggle('collapsed');
    }

    // Enhanced Notifications
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, 4000);
    }

    // Modal Management
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // Enhanced Progress Bar
    function showProgress() {
      progressBar.style.display = 'block';
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 10 + 5;
        if (progress > 90) progress = 90;
        progressFill.style.width = progress + '%';
      }, 300);
      return interval;
    }

    function hideProgress(interval) {
      clearInterval(interval);
      progressFill.style.width = '100%';
      setTimeout(() => {
        progressBar.style.display = 'none';
        progressFill.style.width = '0%';
      }, 800);
    }

    const updateStatus = (msg, isError = false) => {
      status.innerHTML = msg;
      status.style.color = isError ? "var(--error)" : "var(--text-secondary)";
    };

    const clearContainer = () => gameContainer.innerHTML = '<div class="preview-modes"><button class="preview-btn active" data-size="desktop" title="Desktop View">🖥️</button><button class="preview-btn" data-size="tablet" title="Tablet View">📱</button><button class="preview-btn" data-size="mobile" title="Mobile View">📱</button></div>';

    const embedBrowser = (url = 'https://www.google.com') => {
      clearContainer();
      const iframe = document.createElement("iframe");
      iframe.src = url;
      iframe.style.width = getPreviewWidth();
      iframe.style.height = '100%';
      iframe.style.margin = '0 auto';
      iframe.style.display = 'block';
      gameContainer.appendChild(iframe);
      addPreviewModes();
    };

    function getPreviewWidth() {
      switch(currentPreviewSize) {
        case 'mobile': return '375px';
        case 'tablet': return '768px';
        default: return '100%';
      }
    }

    function addPreviewModes() {
      const modes = gameContainer.querySelector('.preview-modes');
      if (modes) {
        modes.addEventListener('click', (e) => {
          if (e.target.classList.contains('preview-btn')) {
            document.querySelectorAll('.preview-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            currentPreviewSize = e.target.dataset.size;
            const iframe = gameContainer.querySelector('iframe');
            if (iframe) {
              iframe.style.width = getPreviewWidth();
            }
          }
        });
      }
    }

    const showGame = (code) => {
      clearContainer();
      lastGeneratedCode = code;
      resetBtn.disabled = false;
      downloadBtn.disabled = false;
      shareBtn.disabled = false;
      document.getElementById('saveProjectBtn').disabled = false;

      const iframe = document.createElement("iframe");
      iframe.sandbox = "allow-scripts allow-same-origin allow-forms allow-pointer-lock allow-popups";
      iframe.style.width = getPreviewWidth();
      iframe.style.height = '100%';
      iframe.style.margin = '0 auto';
      iframe.style.display = 'block';
      gameContainer.appendChild(iframe);

      const isFullHTML = /^\s*<!DOCTYPE|<html/i.test(code);
      const fullHTML = isFullHTML ? code : `
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Generated ${modeSelect.value}</title>
          <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
              font-family: 'Arial', sans-serif;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              display: flex;
              justify-content: center;
              align-items: center;
              min-height: 100vh;
              color: #333;
            }
            canvas { 
              border: 3px solid #fff; 
              border-radius: 10px; 
              box-shadow: 0 10px 30px rgba(0,0,0,0.3);
              background: #fff;
            }
            .game-container {
              text-align: center;
              padding: 20px;
              background: rgba(255,255,255,0.1);
              border-radius: 20px;
              backdrop-filter: blur(10px);
              box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            }
            .game-title {
              color: #fff;
              font-size: 2rem;
              margin-bottom: 20px;
              text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }
            .controls {
              color: #fff;
              margin-top: 15px;
              font-size: 1rem;
              text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            }
          </style>
        </head>
        <body>
          <div class="game-container">
            <div class="game-title">${modeSelect.value.charAt(0).toUpperCase() + modeSelect.value.slice(1)}</div>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
            <div class="controls">Use arrow keys or WASD to control</div>
          </div>
          <script>
            window.addEventListener('load', () => {
              try {
                ${code}
              } catch(e) {
                document.body.innerHTML = '<div style="color:#fff;text-align:center;padding:50px;font-size:1.2rem;"><h2>🔧 Code Generation Error</h2><p style="margin-top:20px;opacity:0.8;">' + e.message + '</p><p style="margin-top:20px;font-size:1rem;">Try regenerating with a different prompt!</p></div>';
                console.error('Generation error:', e);
              }
            });
          <\/script>
        </body></html>
      `;

      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(fullHTML);
      doc.close();

      addPreviewModes();
      updateProjectStats(code);
      addToHistory(currentPrompt, code);
      updateQualityIndicators(code);
    };

    function updateProjectStats(code) {
      const lines = code.split('\n').length;
      const size = Math.round(new Blob([code]).size / 1024);
      const complexity = analyzeComplexity(code);
      
      document.getElementById('codeLines').textContent = lines;
      document.getElementById('codeSize').textContent = size;
      document.getElementById('loadTime').textContent = Math.round(Math.random() * 300 + 150);
    }

    function analyzeComplexity(code) {
      const complexityIndicators = {
        functions: (code.match(/function\s+\w+|=>\s*{|\w+\s*=\s*function/g) || []).length,
        classes: (code.match(/class\s+\w+/g) || []).length,
        loops: (code.match(/for\s*\(|while\s*\(|forEach/g) || []).length,
        conditionals: (code.match(/if\s*\(|switch\s*\(/g) || []).length,
        events: (code.match(/addEventListener|onclick|onkey/g) || []).length
      };
      
      const totalComplexity = Object.values(complexityIndicators).reduce((a, b) => a + b, 0);
      return totalComplexity;
    }

    function updateQualityIndicators(code) {
      const complexity = analyzeComplexity(code);
      const indicatorsContainer = document.getElementById('qualityIndicators');
      
      let badges = [];
      
      if (complexity > 20) {
        badges.push('<span class="quality-badge high">High Quality</span>');
      } else if (complexity > 10) {
        badges.push('<span class="quality-badge medium">Good Quality</span>');
      } else {
        badges.push('<span class="quality-badge basic">Basic</span>');
      }
      
      if (code.includes('canvas') || code.includes('webgl')) {
        badges.push('<span class="quality-badge high">Graphics</span>');
      }
      
      if (code.includes('localStorage') || code.includes('sessionStorage')) {
        badges.push('<span class="quality-badge medium">Persistent</span>');
      }
      
      if (code.includes('class ') && code.includes('constructor')) {
        badges.push('<span class="quality-badge high">OOP</span>');
      }
      
      indicatorsContainer.innerHTML = badges.join('');
    }

    function addToHistory(prompt, code) {
      const historyItem = {
        prompt,
        code,
        timestamp: Date.now(),
        mode: modeSelect.value,
        creativity: creativitySelect.value,
        includeAI: includeAI.checked,
        quality: analyzeComplexity(code)
      };
      generationHistory.unshift(historyItem);
      if (generationHistory.length > 50) generationHistory.pop();
      localStorage.setItem('generationHistory', JSON.stringify(generationHistory));
      updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
      const historyContainer = document.getElementById('versionHistory');
      if (generationHistory.length === 0) {
        historyContainer.innerHTML = '<div style="color: var(--text-muted); padding: 30px; text-align: center; font-size: 1.1rem;">No history yet<br><span style="font-size: 0.9rem;">Your generated projects will appear here</span></div>';
        return;
      }

      historyContainer.innerHTML = generationHistory.map((item, index) => `
        <div class="version-item" onclick="loadFromHistory(${index})">
          <div>
            <div style="font-weight: 600;">${item.prompt.substring(0, 50)}...</div>
            <div class="version-time">${new Date(item.timestamp).toLocaleString()} • ${item.mode} • ${item.creativity || 'creative'}</div>
          </div>
          <div style="font-size: 0.9rem; color: var(--accent);">Quality: ${item.quality}</div>
        </div>
      `).join('');
    }

    function loadFromHistory(index) {
      const item = generationHistory[index];
      promptInput.value = item.prompt;
      modeSelect.value = item.mode;
      creativitySelect.value = item.creativity || 'creative';
      includeAI.checked = item.includeAI;
      showGame(item.code);
      closeModal('historyModal');
      showNotification('🔄 Loaded from history', 'success');
    }

    // Enhanced Favorites Management
    function toggleFavorite() {
      if (!lastGeneratedCode || !currentPrompt) return;

      const favoriteIndex = favorites.findIndex(f => f.prompt === currentPrompt);
      if (favoriteIndex > -1) {
        favorites.splice(favoriteIndex, 1);
        favoriteBtn.classList.remove('active');
        showNotification('💔 Removed from favorites', 'info');
      } else {
        favorites.push({
          prompt: currentPrompt,
          code: lastGeneratedCode,
          mode: modeSelect.value,
          creativity: creativitySelect.value,
          timestamp: Date.now(),
          quality: analyzeComplexity(lastGeneratedCode)
        });
        favoriteBtn.classList.add('active');
        showNotification('⭐ Added to favorites', 'success');
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateFavoritesDisplay();
    }

    function updateFavoritesDisplay() {
      const favoritesContainer = document.getElementById('favoritesList');
      if (favorites.length === 0) {
        favoritesContainer.innerHTML = '<div style="color: var(--text-muted); font-size: 1rem; padding: 20px; text-align: center;">No favorites yet<br><span style="font-size: 0.9rem;">Generate projects and save your favorites!</span></div>';
        return;
      }

      favoritesContainer.innerHTML = favorites.map((item, index) => `
        <div class="favorite-item" onclick="loadFavorite(${index})">
          <div>
            <div style="font-weight: 600;">${item.prompt.substring(0, 30)}...</div>
            <div class="favorite-desc">${item.mode} • ${item.creativity || 'creative'} • Quality: ${item.quality || 'N/A'}</div>
            <div class="favorite-desc">${new Date(item.timestamp).toLocaleDateString()}</div>
          </div>
          <button class="favorite-btn" onclick="event.stopPropagation(); removeFavorite(${index})" title="Remove">🗑️</button>
        </div>
      `).join('');
    }

    function loadFavorite(index) {
      const item = favorites[index];
      promptInput.value = item.prompt;
      modeSelect.value = item.mode;
      creativitySelect.value = item.creativity || 'creative';
      showGame(item.code);
      currentPrompt = item.prompt;
      favoriteBtn.classList.add('active');
      showNotification('⭐ Loaded favorite', 'success');
    }

    function removeFavorite(index) {
      favorites.splice(index, 1);
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateFavoritesDisplay();
      showNotification('🗑️ Favorite removed', 'info');
    }

    // Enhanced Sharing
    function generateShareLink() {
      if (!lastGeneratedCode) return '';
      const data = {
        prompt: currentPrompt,
        code: lastGeneratedCode,
        mode: modeSelect.value,
        creativity: creativitySelect.value,
        timestamp: Date.now()
      };
      return window.location.origin + '?shared=' + btoa(JSON.stringify(data));
    }

    function copyShareLink() {
      const shareInput = document.getElementById('shareInput');
      shareInput.select();
      document.execCommand('copy');
      showNotification('📋 Link copied to clipboard', 'success');
    }

    // Load shared content
    function loadSharedContent() {
      const urlParams = new URLSearchParams(window.location.search);
      const shared = urlParams.get('shared');
      if (shared) {
        try {
          const data = JSON.parse(atob(shared));
          promptInput.value = data.prompt;
          modeSelect.value = data.mode;
          creativitySelect.value = data.creativity || 'creative';
          showGame(data.code);
          currentPrompt = data.prompt;
          showNotification('🔗 Shared project loaded', 'success');
        } catch (e) {
          showNotification('❌ Invalid share link', 'error');
        }
      }
    }

    const containsKeyword = (text, keywords) =>
      keywords.some(k => text.toLowerCase().includes(k));

    // Enhanced Generation Function
    const generateGame = async () => {
      const userPrompt = promptInput.value.trim();
      const selectedMode = modeSelect.value;
      const selectedCreativity = creativitySelect.value;
      
      if (!userPrompt) {
        showNotification('⚠️ Please enter a project description', 'error');
        return;
      }

      currentPrompt = userPrompt;
      favoriteBtn.classList.remove('active');

      // Check if current prompt is in favorites
      if (favorites.some(f => f.prompt === userPrompt)) {
        favoriteBtn.classList.add('active');
      }

      let wantsAI = includeAI.checked;
      const mentionsAI = containsKeyword(userPrompt, AI_KEYWORDS);
      const mentionsChatbot = containsKeyword(userPrompt, CHATBOT_KEYWORDS);
      const mentionsInternet = containsKeyword(userPrompt, INTERNET_KEYWORDS);

      if (mentionsInternet) {
        updateStatus("🌐 Detected internet request — launching embedded browser...");
        embedBrowser();
        currentPrompt = null;
        return;
      }

      if (mentionsChatbot) {
        wantsAI = true;
        includeAI.checked = true;
        updateStatus("🤖 Chatbot detected - integrating Pollinations AI...");
      } else if (mentionsAI) {
        wantsAI = true;
        includeAI.checked = true;
        updateStatus("🤖 AI features detected and enabled...");
      } else {
        updateStatus(`🚀 Creating your ${selectedMode}... <span class="loading-animation"></span>`);
      }

      generateBtn.disabled = true;
      generateBtn.innerHTML = '<span class="loading-animation"></span> Generating...';
      resetBtn.disabled = true;
      downloadBtn.disabled = true;
      shareBtn.disabled = true;

      const progressInterval = showProgress();

      // Professional quality baseline - all projects are now professional grade
      const professionalInstructions = "Build production-ready code with best practices, error handling, performance optimizations, accessibility features, and professional UI/UX design. Use modern JavaScript ES6+ features, responsive design principles, and clean code architecture.";

      // Enhanced prompt engineering based on creativity level
      let creativityInstructions = "";
      switch(selectedCreativity) {
        case "typical":
          creativityInstructions = "Create a well-executed, polished version of this classic concept. Focus on perfecting the fundamentals with excellent execution, smooth gameplay, and refined user experience. Use proven design patterns and familiar mechanics that users expect.";
          break;
        case "creative":
          creativityInstructions = "Add creative twists and unique features to make this stand out. Include innovative mechanics, creative visual elements, and interesting gameplay variations while maintaining core functionality. Think outside the box but keep it accessible.";
          break;
        case "innovative":
          creativityInstructions = "Create something completely original and never-before-seen. Invent new mechanics, unique interaction patterns, and revolutionary features. Push the boundaries of what's possible with creative algorithms, novel user interfaces, and groundbreaking concepts.";
          break;
        case "experimental":
          creativityInstructions = "Go completely wild and experimental. Create bizarre, unconventional, and mind-bending experiences. Use abstract concepts, surreal mechanics, and avant-garde design. Break all conventional rules and create something truly unique and unexpected.";
          break;
      }

      let basePrompt = `Create a professional-grade, high-quality ${selectedMode} using modern HTML5, CSS3, and JavaScript. ${professionalInstructions} ${creativityInstructions}`;

      // Special handling for chatbot projects
      if (mentionsChatbot) {
        basePrompt += ` IMPORTANT: This is a chatbot project. You MUST integrate with Pollinations AI API at https://text.pollinations.ai/ for all AI chat responses. 
        
        Implementation Requirements:
        - Create a clean chat interface with message bubbles for user and AI
        - Use fetch() to call https://text.pollinations.ai/ with user messages
        - Handle the API response and display AI replies in the chat
        - Add typing indicators and smooth message animations
        - Include error handling for API failures
        - Make the chat responsive and mobile-friendly
        
        Example API usage:
        const response = await fetch('https://text.pollinations.ai/' + encodeURIComponent(userMessage));
        const aiReply = await response.text();
        
        Focus on creating an engaging conversational experience with the Pollinations AI as the backend.`;
      }
      // Mode-specific enhancements
      else if (selectedMode === "game") {
        basePrompt += wantsAI
          ? " Include intelligent AI opponents or NPCs with decision-making capabilities. Add smooth animations, particle effects, and immersive gameplay mechanics."
          : " Focus on engaging gameplay mechanics, smooth animations, visual effects, sound feedback, and polished user experience.";
        basePrompt += " Include proper game loops, collision detection, scoring systems, and responsive controls.";
      } else if (selectedMode === "website") {
        basePrompt += wantsAI
          ? " Integrate an intelligent chatbot or virtual assistant with natural language processing capabilities."
          : " Focus on modern web design with responsive layouts, smooth animations, and excellent user experience.";
        basePrompt += " Use modern CSS features like flexbox/grid, smooth scrolling, hover effects, and mobile-first design.";
      } else if (selectedMode === "app") {
        basePrompt += wantsAI
          ? " Include smart features like recommendation systems, predictive text, or intelligent data analysis."
          : " Create a single-page application with modern UI components and smooth interactions.";
        basePrompt += " Include state management, data persistence, form validation, and professional styling.";
      } else if (selectedMode === "tool") {
        basePrompt += wantsAI
          ? " Add intelligent automation, smart suggestions, or AI-powered analysis features."
          : " Focus on utility and efficiency with clean, professional interface design.";
        basePrompt += " Include input validation, error handling, export functionality, and helpful user guidance.";
      }

      basePrompt += ` 

      VISUAL & UX REQUIREMENTS - MANDATORY:
      - Stunning modern UI with glassmorphism, neumorphism, or gradient designs
      - Smooth animations and micro-interactions (hover effects, transitions, transforms)
      - Beautiful color palettes with gradients and proper contrast
      - CSS animations for loading states, button interactions, and visual feedback
      - Responsive design that looks amazing on all devices
      - Professional typography with proper spacing and hierarchy
      - Interactive elements with satisfying click/hover animations
      - Use CSS Grid/Flexbox for perfect layouts
      - Add particle effects, floating elements, or animated backgrounds where appropriate
      - Include progress bars, loading animations, and visual feedback for all actions
      - Implement smooth page transitions and element animations
      - Use box-shadows, border-radius, and backdrop-blur for depth
      - Add emoji and icons for visual appeal
      - Create an immersive, delightful user experience with every interaction
      
      GRAPHICS REQUIREMENTS:
      - Use CSS to create beautiful visual elements (no external images needed)
      - Implement creative use of gradients, patterns, and geometric shapes
      - Add animated SVG icons or CSS-only illustrations
      - Create engaging visual hierarchy with colors and spacing
      - Use CSS transforms for 3D effects where appropriate
      
      All code must be in a single, complete HTML file with embedded CSS and JavaScript. No external dependencies. Generate only clean, working code without any comments, explanations, or chat responses. User request: "${userPrompt}"`;

      try {
        const url = "https://text.pollinations.ai/" + encodeURIComponent(`CRITICAL: Return ONLY executable HTML code. NO explanations, NO comments, NO descriptions, NO text outside code. Start with <!DOCTYPE html> and end with </html>. ${basePrompt}`);
        const res = await fetch(url, {
          method: 'GET',
          headers: {
            'Accept': 'text/html,text/plain',
          }
        });
        
        if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        
        let code = await res.text();
        
        // Enhanced comment and explanation filtering
        code = filterCodeComments(code);
        
        if (!code || code.length < 100) {
          throw new Error("Generated code is too short or empty");
        }
        
        showGame(code.trim());
        updateStatus(`✅ Your ${selectedMode} is ready! 🎉`);
        showNotification('🎯 Creation complete!', 'success');
        
      } catch (err) {
        console.error('Generation error:', err);
        updateStatus("❌ Something went wrong. Please try again with a different idea.", true);
        showNotification('🔄 Try again with a different idea', 'error');
      } finally {
        generateBtn.disabled = false;
        generateBtn.innerHTML = '✨ Generate';
        hideProgress(progressInterval);
      }
    };

    // Event Listeners
    generateBtn.addEventListener("click", generateGame);
    
    promptInput.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        generateGame();
      }
    });

    // Auto-suggest prompts
    promptInput.addEventListener("focus", () => {
      if (!promptInput.value) {
        const randomSuggestion = promptSuggestions[Math.floor(Math.random() * promptSuggestions.length)];
        promptInput.placeholder = randomSuggestion;
      }
    });

    resetBtn.addEventListener("click", () => {
      if (lastGeneratedCode) {
        updateStatus("🔄 Resetting to last generation...");
        showGame(lastGeneratedCode);
        showNotification('🔄 Reset complete', 'info');
      }
    });

    downloadBtn.addEventListener("click", () => {
      if (!lastGeneratedCode) return;
      const blob = new Blob([lastGeneratedCode], {type: "text/html"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `ai-${modeSelect.value}-${creativitySelect.value}-${Date.now()}.html`;
      a.click();
      updateStatus("📦 Downloaded generated file successfully!");
      showNotification('📥 File downloaded', 'success');
    });

    favoriteBtn.addEventListener("click", toggleFavorite);

    // Project management event listeners
    document.getElementById('saveProjectBtn').addEventListener('click', () => {
      if (!lastGeneratedCode) {
        showNotification('❌ No project to save', 'error');
        return;
      }
      document.getElementById('projectNameInput').value = '';
      updateSavedProjectsDisplay();
      document.getElementById('projectModal').style.display = 'flex';
    });

    document.getElementById('loadProjectBtn').addEventListener('click', () => {
      updateSavedProjectsDisplay();
      document.getElementById('projectModal').style.display = 'flex';
    });

    // File import handler
    document.getElementById('importFileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const importData = JSON.parse(event.target.result);
          if (importData.projects && Array.isArray(importData.projects)) {
            // Merge with existing projects, avoiding duplicates
            importData.projects.forEach(project => {
              if (!savedProjects.find(p => p.name === project.name)) {
                project.id = Date.now() + Math.random(); // Ensure unique ID
                savedProjects.push(project);
              }
            });
            localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
            updateSavedProjectsDisplay();
            showNotification(`📥 Imported ${importData.projects.length} projects`, 'success');
          }
        } catch (error) {
          showNotification('❌ Invalid import file', 'error');
        }
      };
      reader.readAsText(file);
      e.target.value = ''; // Reset file input
    });

    shareBtn.addEventListener("click", () => {
      const shareLink = generateShareLink();
      document.getElementById('shareInput').value = shareLink;
      document.getElementById('shareModal').style.display = 'flex';
    });

    function showModal(modalId) {
      if (modalId === 'historyModal') {
        updateHistoryDisplay();
      }
      document.getElementById(modalId).style.display = 'flex';
    }

    if (document.getElementById('historyBtn')) {
      document.getElementById('historyBtn').addEventListener("click", () => showModal('historyModal'));
    }

    // Enhanced Keyboard Shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'Enter':
            e.preventDefault();
            if (!generateBtn.disabled) generateGame();
            break;
          case 'r':
            e.preventDefault();
            if (!resetBtn.disabled) resetBtn.click();
            break;
          case 'd':
            e.preventDefault();
            if (!downloadBtn.disabled) downloadBtn.click();
            break;
          case 'b':
            e.preventDefault();
            toggleSidebar();
            break;
          case 's':
            e.preventDefault();
            if (!shareBtn.disabled) shareBtn.click();
            break;
        }
      }
      
      // ESC to close modals
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal').forEach(modal => {
          modal.style.display = 'none';
        });
      }
    });

    function showShortcuts() {
      const shortcuts = document.getElementById('shortcuts');
      shortcuts.style.display = shortcuts.style.display === 'block' ? 'none' : 'block';
      setTimeout(() => {
        shortcuts.style.display = 'none';
      }, 8000);
    }

    function setSuggestion(suggestion) {
      promptInput.value = suggestion;
      promptInput.focus();
      showNotification('💡 Suggestion added! Click "Create It!" to generate', 'info');
    }

    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
      }
    });

    // Enhanced keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'Enter':
            e.preventDefault();
            if (!generateBtn.disabled) generateGame();
            break;
          case 'r':
            e.preventDefault();
            if (!resetBtn.disabled) resetBtn.click();
            break;
          case 'd':
            e.preventDefault();
            if (!downloadBtn.disabled) downloadBtn.click();
            break;
          case 's':
            e.preventDefault();
            if (e.shiftKey) {
              // Ctrl+Shift+S for save project
              if (!document.getElementById('saveProjectBtn').disabled) {
                document.getElementById('saveProjectBtn').click();
              }
            } else {
              // Ctrl+S for share
              if (!shareBtn.disabled) shareBtn.click();
            }
            break;
          case 'o':
            e.preventDefault();
            document.getElementById('loadProjectBtn').click();
            break;
          case 'b':
            e.preventDefault();
            toggleSidebar();
            break;
        }
      }
      
      // ESC to close modals
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal').forEach(modal => {
          modal.style.display = 'none';
        });
      }
    });

    // Save project with Enter key in modal
    document.getElementById('projectNameInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        saveCurrentProject();
      }
    });

    // Initialize
    updateFavoritesDisplay();
    updateHistoryDisplay();
    updateSavedProjectsDisplay();
    loadSharedContent();
    
    // Welcome message
    setTimeout(() => {
      showNotification('🎯 Ready to create amazing projects! New: Save & manage your creations!', 'info');
    }, 1000);
  </script>

</body>

</html>
