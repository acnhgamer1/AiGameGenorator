<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🧠 AI Project Generator</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #161620;
      --bg-tertiary: #1e1e2e;
      --bg-card: #252535;
      --text-primary: #ffffff;
      --text-secondary: #b8b8c8;
      --text-muted: #6c6c7c;
      --accent: #00d4ff;
      --accent-hover: #00b8e6;
      --accent-glow: rgba(0, 212, 255, 0.4);
      --error: #ff4757;
      --warning: #ffa502;
      --success: #2ed573;
      --info: #5352ed;
      --border: #3a3a4a;
      --shadow: rgba(0, 0, 0, 0.4);
      --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --glass: rgba(255, 255, 255, 0.1);
      --backdrop: backdrop-filter: blur(20px);
    }

    [data-theme="light"] {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #e9ecef;
      --bg-card: #ffffff;
      --text-primary: #212529;
      --text-secondary: #495057;
      --text-muted: #6c757d;
      --accent: #007bff;
      --accent-hover: #0056b3;
      --accent-glow: rgba(0, 123, 255, 0.3);
      --border: #dee2e6;
      --shadow: rgba(0, 0, 0, 0.15);
      --glass: rgba(0, 0, 0, 0.05);
    }

    body {
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      line-height: 1.6;
      overflow: hidden;
    }

    header {
      padding: 1rem 1.5rem;
      background: var(--glass);
      var(--backdrop);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 8px 32px var(--shadow);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      position: relative;
      z-index: 100;
    }

    .header-title {
      font-size: 2rem;
      font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
      text-shadow: 0 2px 10px var(--accent-glow);
    }

    .header-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .theme-toggle {
      background: var(--glass);
      var(--backdrop);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 12px 18px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 20px var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .theme-toggle::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--glass), transparent);
      transition: left 0.6s ease;
    }

    .theme-toggle:hover::before {
      left: 100%;
    }

    .theme-toggle:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 30px var(--shadow);
      border-color: var(--accent);
    }

    #controls {
      display: flex;
      gap: 15px;
      padding: 1rem 1.5rem;
      background: var(--glass);
      var(--backdrop);
      align-items: center;
      flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      position: relative;
      z-index: 90;
    }

    #promptInput {
      flex: 1;
      min-width: 300px;
      padding: 18px 24px;
      border: 2px solid var(--border);
      border-radius: 50px;
      background: var(--glass);
      var(--backdrop);
      color: var(--text-primary);
      font-size: 1.1rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 20px var(--shadow);
      outline: none;
    }

    #promptInput:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--accent-glow), 0 8px 30px var(--shadow);
      transform: translateY(-2px);
    }

    #promptInput::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }

    button {
      padding: 14px 28px;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 1rem;
      box-shadow: 0 6px 25px var(--accent-glow);
      position: relative;
      overflow: hidden;
      letter-spacing: 0.5px;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.6s ease;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 10px 40px var(--accent-glow);
    }

    button:active {
      transform: translateY(-1px) scale(1.02);
    }

    button:disabled {
      background: linear-gradient(135deg, var(--text-muted) 0%, var(--border) 100%);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .secondary-btn {
      background: var(--glass);
      var(--backdrop);
      color: var(--text-primary);
      border: 2px solid var(--border);
      box-shadow: 0 4px 20px var(--shadow);
    }

    .secondary-btn:hover:not(:disabled) {
      background: var(--bg-card);
      border-color: var(--accent);
      color: var(--accent);
    }

    #status {
      text-align: center;
      padding: 12px;
      font-size: 1rem;
      background: var(--glass);
      var(--backdrop);
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      flex-shrink: 0;
      transition: all 0.4s ease;
    }

    #mainContent {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    #sidebar {
      width: 340px;
      background: var(--glass);
      var(--backdrop);
      border-right: 1px solid var(--border);
      overflow-y: auto;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 8px 0 32px var(--shadow);
      flex-shrink: 0;
      height: 100%;
    }

    #sidebar.collapsed {
      transform: translateX(-100%);
      width: 0;
    }

    .sidebar-section {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      animation: fadeInUp 0.6s ease-out;
    }

    .sidebar-title {
      font-weight: 800;
      margin-bottom: 1.2rem;
      color: var(--accent);
      font-size: 1.2rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      position: relative;
    }

    .sidebar-title::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--gradient);
      border-radius: 2px;
    }

    .favorite-item, .suggestion-btn {
      padding: 18px 22px;
      margin: 10px 0;
      background: var(--glass);
      var(--backdrop);
      border-radius: 16px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--border);
      box-shadow: 0 4px 20px var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .favorite-item::before, .suggestion-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--glass), transparent);
      transition: left 0.6s ease;
    }

    .favorite-item:hover::before, .suggestion-btn:hover::before {
      left: 100%;
    }

    .favorite-item:hover, .suggestion-btn:hover {
      background: var(--accent);
      color: white;
      transform: translateX(8px) translateY(-2px);
      box-shadow: 0 8px 30px var(--accent-glow);
      border-color: var(--accent);
    }

    .favorite-desc {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    #gameContainer {
      flex: 1;
      margin: 15px;
      overflow: hidden;
      border-radius: 20px;
      box-shadow: 0 15px 50px var(--shadow);
      background: var(--bg-primary);
      position: relative;
      border: 1px solid var(--border);
      min-height: 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #gameContainer:hover {
      transform: scale(1.002);
      box-shadow: 0 20px 60px var(--shadow);
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 20px;
      transition: all 0.4s ease;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1rem;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .toggle-container select,
    .toggle-container input[type="checkbox"] {
      background: var(--glass);
      var(--backdrop);
      color: var(--text-primary);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      font-size: 1rem;
      accent-color: var(--accent);
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .toggle-container select:focus,
    .toggle-container input[type="checkbox"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .actions {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      animation: fadeIn 0.4s ease-out;
    }

    .modal-content {
      background: var(--glass);
      var(--backdrop);
      padding: 3rem;
      border-radius: 24px;
      max-width: 700px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6);
      border: 1px solid var(--border);
      animation: slideInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .modal-title {
      font-size: 1.6rem;
      font-weight: 800;
      color: var(--accent);
      letter-spacing: -0.5px;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 2.2rem;
      cursor: pointer;
      color: var(--text-muted);
      padding: 0;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-btn:hover {
      background: var(--error);
      color: white;
      transform: scale(1.1);
    }

    .favorite-btn {
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      color: var(--text-muted);
      padding: 10px;
      border-radius: 12px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .favorite-btn:hover {
      color: var(--warning);
      background: var(--glass);
      transform: scale(1.15);
    }

    .favorite-btn.active {
      color: var(--warning);
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-card);
      border-radius: 4px;
      overflow: hidden;
      margin: 15px 0;
      box-shadow: inset 0 2px 8px var(--shadow);
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient);
      width: 0%;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 4px;
      box-shadow: 0 0 20px var(--accent-glow);
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    .stats-container {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      font-size: 1rem;
      color: var(--text-muted);
      flex-wrap: wrap;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      background: var(--glass);
      var(--backdrop);
      border-radius: 25px;
      border: 1px solid var(--border);
      transition: all 0.4s ease;
    }

    .stat-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow);
    }

    .version-history {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .version-item {
      padding: 18px;
      margin: 10px 0;
      background: var(--glass);
      var(--backdrop);
      border-radius: 16px;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }

    .version-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--glass), transparent);
      transition: left 0.6s ease;
    }

    .version-item:hover::before {
      left: 100%;
    }

    .version-item:hover {
      background: var(--bg-tertiary);
      transform: translateX(10px) translateY(-2px);
      box-shadow: 0 8px 30px var(--shadow);
    }

    .version-time {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .notification {
      position: fixed;
      top: 30px;
      right: 30px;
      padding: 18px 28px;
      border-radius: 16px;
      color: white;
      font-weight: 700;
      z-index: 1001;
      transform: translateX(400px);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      var(--backdrop);
      border: 1px solid var(--border);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: linear-gradient(135deg, var(--success) 0%, #25d366 100%);
    }

    .notification.error {
      background: linear-gradient(135deg, var(--error) 0%, #ff3838 100%);
    }

    .notification.info {
      background: linear-gradient(135deg, var(--info) 0%, #4d4dff 100%);
    }

    .generation-tips {
      background: var(--glass);
      var(--backdrop);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      margin: 15px 0;
      transition: all 0.4s ease;
    }

    .generation-tips:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px var(--shadow);
    }

    .tip-title {
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 15px;
      font-size: 1.2rem;
      letter-spacing: 0.5px;
    }

    .loading-animation {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid var(--border);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s linear infinite;
    }

    .quality-indicators {
      display: flex;
      gap: 12px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .quality-badge {
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.4s ease;
    }

    .quality-badge:hover {
      transform: scale(1.05);
    }

    .quality-badge.high {
      background: linear-gradient(135deg, var(--success) 0%, #25d366 100%);
      color: white;
    }

    .quality-badge.medium {
      background: linear-gradient(135deg, var(--warning) 0%, #ffb84d 100%);
      color: white;
    }

    .quality-badge.basic {
      background: linear-gradient(135deg, var(--info) 0%, #4d4dff 100%);
      color: white;
    }

    .project-card {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .project-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, var(--glass), transparent);
      transition: left 0.6s ease;
    }

    .project-card:hover::before {
      left: 100%;
    }

    .project-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 12px 40px var(--shadow);
      border-color: var(--accent);
    }

    @media (max-width: 768px) {
      #sidebar {
        position: absolute;
        height: 100%;
        z-index: 200;
        width: 300px;
      }
      
      .header-controls {
        flex-wrap: wrap;
        gap: 8px;
      }
      
      #controls {
        flex-direction: column;
        align-items: stretch;
        padding: 1rem;
      }
      
      .actions {
        justify-content: center;
      }

      #promptInput {
        min-width: 200px;
      }

      #gameContainer {
        margin: 10px;
      }

      .header-title {
        font-size: 1.6rem;
      }

      button {
        padding: 12px 20px;
        font-size: 0.9rem;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Auto-responsive container */
    .responsive-preview {
      width: 100%;
      height: 100%;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 20px;
      overflow: hidden;
    }

    /* Smooth scrollbars */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
    }

    /* Enhanced focus styles */
    button:focus,
    input:focus,
    select:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* Glassmorphism enhancements */
    .glass-card {
      background: var(--glass);
      var(--backdrop);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 8px 32px var(--shadow);
    }
  </style>
</head>

<body data-theme="dark">

  <header>
    <div class="header-title">🧠 AI Project Generator</div>
    <div class="header-controls">
      <button class="theme-toggle secondary-btn" onclick="toggleTheme()">🌙</button>
      <button class="secondary-btn" onclick="toggleSidebar()">💡 Ideas</button>
      <button class="secondary-btn" onclick="showModal('historyModal')">📝 History</button>
    </div>
  </header>

  <div id="controls">
    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; width: 100%;">
      <input id="promptInput" placeholder="What do you want to create? (e.g., snake game, calculator, todo list)" style="flex: 1; min-width: 300px;" />
      
      <div class="toggle-container">
        <label for="modeSelect">I want a:</label>
        <select id="modeSelect">
          <option value="game">🎮 Game</option>
          <option value="website">🌐 Website</option>
          <option value="app">📱 App</option>
          <option value="tool">🔧 Tool</option>
        </select>
      </div>

      <button id="generateBtn" style="padding: 18px 36px; font-size: 1.2rem; font-weight: 800;">✨ Create It!</button>
    </div>

    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; margin-top: 15px; justify-content: center;">
      <div class="toggle-container">
        <label for="creativitySelect">Creativity Level:</label>
        <select id="creativitySelect">
          <option value="typical">🎯 Typical & Polished</option>
          <option value="creative" selected>🎨 Creative & Unique</option>
          <option value="innovative">🚀 Completely Original</option>
          <option value="experimental">🔬 Experimental & Wild</option>
        </select>
      </div>

      <div class="toggle-container">
        <input type="checkbox" id="includeAI" />
        <label for="includeAI">🤖 Add AI Features</label>
      </div>

      <button id="downloadBtn" class="secondary-btn" disabled>📥 Download</button>
      <button id="resetBtn" class="secondary-btn" disabled>🔄 Try Again</button>
    </div>
  </div>

  <div id="status">Ready to create something amazing! 🚀</div>
  
  <div class="progress-bar" id="progressBar" style="display: none;">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <div id="mainContent">
    <div id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">💡 Popular Projects</div>
        <div class="generation-tips">
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <button class="suggestion-btn" onclick="setSuggestion('snake game with colorful graphics')">🐍 Snake Game</button>
            <button class="suggestion-btn" onclick="setSuggestion('calculator with big buttons')">🧮 Calculator</button>
            <button class="suggestion-btn" onclick="setSuggestion('todo list with checkboxes')">📝 Todo List</button>
            <button class="suggestion-btn" onclick="setSuggestion('memory card matching game')">🃏 Memory Game</button>
            <button class="suggestion-btn" onclick="setSuggestion('drawing app with colors')">🎨 Drawing App</button>
            <button class="suggestion-btn" onclick="setSuggestion('simple quiz game')">❓ Quiz Game</button>
            <button class="suggestion-btn" onclick="setSuggestion('ai chatbot with personality')">🤖 AI Chatbot</button>
            <button class="suggestion-btn" onclick="setSuggestion('customer service chatbot')">💬 Support Bot</button>
          </div>
        </div>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-title">💾 My Projects</div>
        <div id="savedProjectsList">
          <div style="color: var(--text-muted); font-size: 1rem; padding: 20px; text-align: center;">No projects saved yet<br><span style="font-size: 0.9rem;">Save your creations to manage them!</span></div>
        </div>
        <div style="text-align: center; margin-top: 15px;">
          <button id="saveProjectBtn" class="secondary-btn" title="Save Current Project" disabled>💾 Save Project</button>
          <button id="loadProjectBtn" class="secondary-btn" style="margin-top: 8px; width: 100%;">📂 Load Project</button>
          <button id="shareBtn" class="secondary-btn" disabled style="margin-top: 8px; width: 100%;">🔗 Share Creation</button>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">⭐ Favorites</div>
        <div id="favoritesList">
          <div style="color: var(--text-muted); font-size: 1rem; padding: 20px; text-align: center;">No favorites yet<br><span style="font-size: 0.9rem;">Star your best creations!</span></div>
        </div>
        <div style="text-align: center; margin-top: 15px;">
          <button id="favoriteBtn" class="secondary-btn" title="Add to Favorites" disabled>⭐ Add Favorite</button>
        </div>
      </div>
    </div>

    <div id="gameContainer">
      <!-- Automatic responsive preview container -->
      <div class="responsive-preview" id="previewContainer"></div>
    </div>
  </div>

  <!-- Modals -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">📝 Generation History</div>
        <button class="close-btn" onclick="closeModal('historyModal')">&times;</button>
      </div>
      <div class="version-history" id="versionHistory">
        <div style="color: var(--text-muted); padding: 30px; text-align: center; font-size: 1.1rem;">No history yet<br><span style="font-size: 0.9rem;">Your generated projects will appear here</span></div>
      </div>
    </div>
  </div>

  <div id="shareModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">🔗 Share Project</div>
        <button class="close-btn" onclick="closeModal('shareModal')">&times;</button>
      </div>
      <div style="display: flex; gap: 15px; align-items: center; margin: 15px 0;">
        <input type="text" id="shareInput" readonly style="flex: 1; padding: 12px; background: var(--bg-card); border: 2px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 1rem;" />
        <button onclick="copyShareLink()">📋 Copy</button>
      </div>
      <div class="quality-indicators" id="qualityIndicators"></div>
      <div style="margin-top: 20px;">
        <div class="stats-container" id="projectStats">
          <div class="stat-item">📝 <span id="codeLines">0</span> lines</div>
          <div class="stat-item">⚡ <span id="loadTime">0</span>ms</div>
          <div class="stat-item">📦 <span id="codeSize">0</span>KB</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Project Management Modal -->
  <div id="projectModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">💾 Project Manager</div>
        <button class="close-btn" onclick="closeModal('projectModal')">&times;</button>
      </div>
      <div style="margin-bottom: 20px;">
        <input type="text" id="projectNameInput" placeholder="Enter project name..." style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; background: var(--bg-card); color: var(--text-primary); font-size: 1rem;" />
      </div>
      <div id="savedProjectsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; max-height: 400px; overflow-y: auto;">
        <!-- Saved projects will appear here -->
      </div>
      <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
        <button onclick="exportAllProjects()" class="secondary-btn">📤 Export All</button>
        <button onclick="importProjects()" class="secondary-btn">📥 Import</button>
        <button onclick="clearAllProjects()" class="secondary-btn" style="background: var(--error);">🗑️ Clear All</button>
      </div>
    </div>
  </div>

  <!-- Import File Input -->
  <input type="file" id="importFileInput" accept=".json" style="display: none;" />

  <div id="notification" class="notification"></div>

  <script>
    const promptInput = document.getElementById("promptInput");
    const generateBtn = document.getElementById("generateBtn");
    const resetBtn = document.getElementById("resetBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const shareBtn = document.getElementById("shareBtn");
    const favoriteBtn = document.getElementById("favoriteBtn");
    const historyBtn = document.getElementById("historyBtn");
    const gameContainer = document.getElementById("gameContainer");
    const previewContainer = document.getElementById("previewContainer");
    const status = document.getElementById("status");
    const includeAI = document.getElementById("includeAI");
    const modeSelect = document.getElementById("modeSelect");
    const creativitySelect = document.getElementById("creativitySelect");
    const progressBar = document.getElementById("progressBar");
    const progressFill = document.getElementById("progressFill");
    const sidebar = document.getElementById("sidebar");

    const AI_KEYWORDS = ['chatbot', 'ai npc', 'talking npc', 'assistant', 'conversation', 'talk to', 'text input', 'dialogue', 'interactive npc', 'ai character', 'smart', 'intelligent'];
    const CHATBOT_KEYWORDS = ['chatbot', 'chat bot', 'ai chat', 'conversation bot', 'talking bot', 'virtual assistant', 'ai assistant', 'chat assistant', 'dialogue system', 'conversational ai'];
    const INTERNET_KEYWORDS = ['internet', 'browse', 'online', 'web access', 'fetch data', 'api'];

    let lastGeneratedCode = null;
    let currentPrompt = null;
    let generationHistory = JSON.parse(localStorage.getItem('generationHistory')) || [];
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    let savedProjects = JSON.parse(localStorage.getItem('savedProjects')) || [];

    // Auto-detect device capabilities for responsive design
    function getOptimalViewport() {
      const width = window.innerWidth;
      const height = window.innerHeight;
      const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      
      // Auto-determine the best preview based on screen size and capabilities
      if (width <= 480) return { type: 'mobile', width: '100%', maxWidth: '375px' };
      if (width <= 768) return { type: 'tablet', width: '100%', maxWidth: '768px' };
      return { type: 'desktop', width: '100%', maxWidth: 'none' };
    }

    // Enhanced comment filtering function
    function filterCodeComments(code) {
      // Remove any text before the first HTML tag
      const htmlStart = code.indexOf('<!DOCTYPE html>') !== -1 ? code.indexOf('<!DOCTYPE html>') : 
                       code.indexOf('<html') !== -1 ? code.indexOf('<html') : 0;
      
      if (htmlStart > 0) {
        code = code.substring(htmlStart);
      }
      
      // Remove text after closing html tag
      const htmlEnd = code.lastIndexOf('</html>');
      if (htmlEnd !== -1) {
        code = code.substring(0, htmlEnd + 7);
      }
      
      // Remove HTML comments
      code = code.replace(/<!--[\s\S]*?-->/g, '');
      
      // Remove CSS comments
      code = code.replace(/\/\*[\s\S]*?\*\//g, '');
      
      // Remove JavaScript comments (single line)
      code = code.replace(/\/\/.*$/gm, '');
      
      // Remove JavaScript comments (multi-line) more carefully
      code = code.replace(/\/\*[\s\S]*?\*\//g, '');
      
      // Remove explanatory text that might appear before or after code
      const patterns = [
        /^[^<]*(?=<!DOCTYPE|<html)/i,  // Remove text before HTML
        /<\/html>[^<]*$/i,            // Remove text after closing HTML
        /```[\s\S]*?```/g,            // Remove code blocks
        /Here's.*?:/gi,               // Remove "Here's the code:"
        /This.*?creates?/gi,          // Remove explanations
        /The.*?code/gi,               // Remove "The code does..."
        /^[A-Za-z\s:,.-]*(?=<!DOCTYPE|<html)/m  // Remove leading explanations
      ];
      
      patterns.forEach(pattern => {
        code = code.replace(pattern, '');
      });
      
      return code.trim();
    }

    // Enhanced showGame function with automatic responsive design
    const showGame = (code) => {
      previewContainer.innerHTML = '';
      lastGeneratedCode = code;
      resetBtn.disabled = false;
      downloadBtn.disabled = false;
      shareBtn.disabled = false;
      document.getElementById('saveProjectBtn').disabled = false;

      const viewport = getOptimalViewport();
      
      const iframe = document.createElement("iframe");
      iframe.sandbox = "allow-scripts allow-same-origin allow-forms allow-pointer-lock allow-popups";
      iframe.style.width = viewport.width;
      iframe.style.height = '100%';
      iframe.style.maxWidth = viewport.maxWidth;
      iframe.style.margin = '0 auto';
      iframe.style.display = 'block';
      iframe.style.borderRadius = '20px';
      iframe.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
      iframe.className = 'responsive-preview';
      
      previewContainer.appendChild(iframe);

      const isFullHTML = /^\s*<!DOCTYPE|<html/i.test(code);
      const fullHTML = isFullHTML ? code : `
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Generated ${modeSelect.value}</title>
          <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
              font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              display: flex;
              justify-content: center;
              align-items: center;
              min-height: 100vh;
              color: #333;
              padding: 20px;
            }
            canvas { 
              border: 3px solid #fff; 
              border-radius: 15px; 
              box-shadow: 0 15px 40px rgba(0,0,0,0.3);
              background: #fff;
            }
            .game-container {
              text-align: center;
              padding: 30px;
              background: rgba(255,255,255,0.15);
              border-radius: 25px;
              backdrop-filter: blur(20px);
              box-shadow: 0 20px 50px rgba(0,0,0,0.3);
              border: 1px solid rgba(255,255,255,0.2);
            }
            .game-title {
              color: #fff;
              font-size: 2.5rem;
              margin-bottom: 25px;
              text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
              font-weight: 800;
            }
            .controls {
              color: #fff;
              margin-top: 20px;
              font-size: 1.1rem;
              text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
              opacity: 0.9;
            }
            @media (max-width: 768px) {
              .game-container { padding: 20px; }
              .game-title { font-size: 2rem; }
              canvas { max-width: 100%; height: auto; }
            }
          </style>
        </head>
        <body>
          <div class="game-container">
            <div class="game-title">${modeSelect.value.charAt(0).toUpperCase() + modeSelect.value.slice(1)}</div>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
            <div class="controls">Use arrow keys or WASD to control</div>
          </div>
          <script>
            window.addEventListener('load', () => {
              try {
                ${code}
              } catch(e) {
                document.body.innerHTML = '<div style="color:#fff;text-align:center;padding:50px;font-size:1.2rem;background:linear-gradient(135deg,#ff4757,#ff3838);border-radius:20px;margin:20px;"><h2>🔧 Code Generation Error</h2><p style="margin-top:20px;opacity:0.9;">' + e.message + '</p><p style="margin-top:20px;font-size:1rem;">Try regenerating with a different prompt!</p></div>';
                console.error('Generation error:', e);
              }
            });
          <\/script>
        </body></html>
      `;

      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(fullHTML);
      doc.close();

      updateProjectStats(code);
      addToHistory(currentPrompt, code);
      updateQualityIndicators(code);
      
      // Auto-adjust iframe on window resize
      window.addEventListener('resize', () => {
        const newViewport = getOptimalViewport();
        iframe.style.width = newViewport.width;
        iframe.style.maxWidth = newViewport.maxWidth;
      });
    };

    // Auto browser embedding with responsive design
    const embedBrowser = (url = 'https://www.google.com') => {
      previewContainer.innerHTML = '';
      const viewport = getOptimalViewport();
      
      const iframe = document.createElement("iframe");
      iframe.src = url;
      iframe.style.width = viewport.width;
      iframe.style.height = '100%';
      iframe.style.maxWidth = viewport.maxWidth;
      iframe.style.margin = '0 auto';
      iframe.style.display = 'block';
      iframe.style.borderRadius = '20px';
      iframe.className = 'responsive-preview';
      
      previewContainer.appendChild(iframe);
    };

    // Project Management Functions
    function saveCurrentProject() {
      if (!lastGeneratedCode || !currentPrompt) {
        showNotification('❌ No project to save', 'error');
        return;
      }
      
      const projectName = document.getElementById('projectNameInput').value.trim() || 
                         `${modeSelect.value}-${Date.now()}`;
      
      const project = {
        id: Date.now(),
        name: projectName,
        prompt: currentPrompt,
        code: lastGeneratedCode,
        mode: modeSelect.value,
        creativity: creativitySelect.value,
        includesAI: includeAI.checked,
        timestamp: Date.now(),
        size: Math.round(new Blob([lastGeneratedCode]).size / 1024),
        quality: analyzeComplexity(lastGeneratedCode)
      };
      
      // Check for duplicate names
      const existingIndex = savedProjects.findIndex(p => p.name === projectName);
      if (existingIndex > -1) {
        savedProjects[existingIndex] = project;
        showNotification('✅ Project updated', 'success');
      } else {
        savedProjects.push(project);
        showNotification('💾 Project saved successfully', 'success');
      }
      
      localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
      updateSavedProjectsDisplay();
      closeModal('projectModal');
    }

    function updateSavedProjectsDisplay() {
      const container = document.getElementById('savedProjectsList');
      const gridContainer = document.getElementById('savedProjectsGrid');
      
      if (savedProjects.length === 0) {
        container.innerHTML = '<div style="color: var(--text-muted); font-size: 1rem; padding: 20px; text-align: center;">No projects saved yet<br><span style="font-size: 0.9rem;">Save your creations to manage them!</span></div>';
        if (gridContainer) gridContainer.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: var(--text-muted); padding: 40px;">No saved projects</div>';
        return;
      }

      // Update sidebar list
      container.innerHTML = savedProjects.slice(0, 5).map((project, index) => `
        <div class="favorite-item" onclick="loadSavedProject(${project.id})">
          <div>
            <div style="font-weight: 600;">${project.name}</div>
            <div class="favorite-desc">${project.mode} • ${project.creativity} • ${project.size}KB</div>
            <div class="favorite-desc">${new Date(project.timestamp).toLocaleDateString()}</div>
          </div>
          <button class="favorite-btn" onclick="event.stopPropagation(); deleteProject(${project.id})" title="Delete">🗑️</button>
        </div>
      `).join('') + (savedProjects.length > 5 ? '<div style="text-align: center; margin-top: 10px; color: var(--text-muted); font-size: 0.9rem;">+ ' + (savedProjects.length - 5) + ' more in Project Manager</div>' : '');

      // Update modal grid
      if (gridContainer) {
        gridContainer.innerHTML = savedProjects.map(project => `
          <div class="project-card glass-card" style="padding: 20px; cursor: pointer;" onclick="loadSavedProject(${project.id})">
            <div style="font-weight: 700; margin-bottom: 10px; color: var(--text-primary); font-size: 1.1rem;">${project.name}</div>
            <div style="font-size: 0.95rem; color: var(--text-muted); margin-bottom: 15px; line-height: 1.4;">${project.prompt.substring(0, 80)}...</div>
            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--text-muted);">
              <span>${project.mode} • ${project.size}KB</span>
              <button onclick="event.stopPropagation(); deleteProject(${project.id})" style="background: var(--error); color: white; border: none; border-radius: 8px; padding: 6px 10px; cursor: pointer; transition: all 0.3s ease;">🗑️</button>
            </div>
          </div>
        `).join('');
      }
    }

    function loadSavedProject(projectId) {
      const project = savedProjects.find(p => p.id === projectId);
      if (!project) return;
      
      promptInput.value = project.prompt;
      modeSelect.value = project.mode;
      creativitySelect.value = project.creativity;
      includeAI.checked = project.includesAI;
      showGame(project.code);
      currentPrompt = project.prompt;
      
      closeModal('projectModal');
      showNotification('📂 Project loaded successfully', 'success');
    }

    function deleteProject(projectId) {
      if (confirm('Are you sure you want to delete this project?')) {
        savedProjects = savedProjects.filter(p => p.id !== projectId);
        localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
        updateSavedProjectsDisplay();
        showNotification('🗑️ Project deleted', 'info');
      }
    }

    function updateProjectStats(code) {
      const lines = code.split('\n').length;
      const size = Math.round(new Blob([code]).size / 1024);
      const complexity = analyzeComplexity(code);
      
      document.getElementById('codeLines').textContent = lines;
      document.getElementById('codeSize').textContent = size;
      document.getElementById('loadTime').textContent = Math.round(Math.random() * 300 + 150);
    }

    function analyzeComplexity(code) {
      const complexityIndicators = {
        functions: (code.match(/function\s+\w+|=>\s*{|\w+\s*=\s*function/g) || []).length,
        classes: (code.match(/class\s+\w+/g) || []).length,
        loops: (code.match(/for\s*\(|while\s*\(|forEach/g) || []).length,
        conditionals: (code.match(/if\s*\(|switch\s*\(/g) || []).length,
        events: (code.match(/addEventListener|onclick|onkey/g) || []).length
      };
      
      const totalComplexity = Object.values(complexityIndicators).reduce((a, b) => a + b, 0);
      return totalComplexity;
    }

    function updateQualityIndicators(code) {
      const complexity = analyzeComplexity(code);
      const indicatorsContainer = document.getElementById('qualityIndicators');
      
      let badges = [];
      
      if (complexity > 20) {
        badges.push('<span class="quality-badge high">High Quality</span>');
      } else if (complexity > 10) {
        badges.push('<span class="quality-badge medium">Good Quality</span>');
      } else {
        badges.push('<span class="quality-badge basic">Basic</span>');
      }
      
      if (code.includes('canvas') || code.includes('webgl')) {
        badges.push('<span class="quality-badge high">Graphics</span>');
      }
      
      if (code.includes('localStorage') || code.includes('sessionStorage')) {
        badges.push('<span class="quality-badge medium">Persistent</span>');
      }
      
      if (code.includes('class ') && code.includes('constructor')) {
        badges.push('<span class="quality-badge high">OOP</span>');
      }
      
      indicatorsContainer.innerHTML = badges.join('');
    }

    function addToHistory(prompt, code) {
      const historyItem = {
        prompt,
        code,
        timestamp: Date.now(),
        mode: modeSelect.value,
        creativity: creativitySelect.value,
        includeAI: includeAI.checked,
        quality: analyzeComplexity(code)
      };
      generationHistory.unshift(historyItem);
      if (generationHistory.length > 50) generationHistory.pop();
      localStorage.setItem('generationHistory', JSON.stringify(generationHistory));
      updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
      const historyContainer = document.getElementById('versionHistory');
      if (generationHistory.length === 0) {
        historyContainer.innerHTML = '<div style="color: var(--text-muted); padding: 30px; text-align: center; font-size: 1.1rem;">No history yet<br><span style="font-size: 0.9rem;">Your generated projects will appear here</span></div>';
        return;
      }

      historyContainer.innerHTML = generationHistory.map((item, index) => `
        <div class="version-item" onclick="loadFromHistory(${index})">
          <div>
            <div style="font-weight: 700; font-size: 1.1rem;">${item.prompt.substring(0, 60)}...</div>
            <div class="version-time">${new Date(item.timestamp).toLocaleString()} • ${item.mode} • ${item.creativity || 'creative'}</div>
          </div>
          <div style="font-size: 1rem; color: var(--accent); font-weight: 600;">Q: ${item.quality}</div>
        </div>
      `).join('');
    }

    function loadFromHistory(index) {
      const item = generationHistory[index];
      promptInput.value = item.prompt;
      modeSelect.value = item.mode;
      creativitySelect.value = item.creativity || 'creative';
      includeAI.checked = item.includeAI;
      showGame(item.code);
      closeModal('historyModal');
      showNotification('🔄 Loaded from history', 'success');
    }

    // Enhanced Favorites Management
    function toggleFavorite() {
      if (!lastGeneratedCode || !currentPrompt) return;

      const favoriteIndex = favorites.findIndex(f => f.prompt === currentPrompt);
      if (favoriteIndex > -1) {
        favorites.splice(favoriteIndex, 1);
        favoriteBtn.classList.remove('active');
        showNotification('💔 Removed from favorites', 'info');
      } else {
        favorites.push({
          prompt: currentPrompt,
          code: lastGeneratedCode,
          mode: modeSelect.value,
          creativity: creativitySelect.value,
          timestamp: Date.now(),
          quality: analyzeComplexity(lastGeneratedCode)
        });
        favoriteBtn.classList.add('active');
        showNotification('⭐ Added to favorites', 'success');
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateFavoritesDisplay();
    }

    function updateFavoritesDisplay() {
      const favoritesContainer = document.getElementById('favoritesList');
      if (favorites.length === 0) {
        favoritesContainer.innerHTML = '<div style="color: var(--text-muted); font-size: 1rem; padding: 20px; text-align: center;">No favorites yet<br><span style="font-size: 0.9rem;">Generate projects and save your favorites!</span></div>';
        return;
      }

      favoritesContainer.innerHTML = favorites.map((item, index) => `
        <div class="favorite-item" onclick="loadFavorite(${index})">
          <div>
            <div style="font-weight: 700;">${item.prompt.substring(0, 35)}...</div>
            <div class="favorite-desc">${item.mode} • ${item.creativity || 'creative'} • Q: ${item.quality || 'N/A'}</div>
            <div class="favorite-desc">${new Date(item.timestamp).toLocaleDateString()}</div>
          </div>
          <button class="favorite-btn" onclick="event.stopPropagation(); removeFavorite(${index})" title="Remove">🗑️</button>
        </div>
      `).join('');
    }

    function loadFavorite(index) {
      const item = favorites[index];
      promptInput.value = item.prompt;
      modeSelect.value = item.mode;
      creativitySelect.value = item.creativity || 'creative';
      showGame(item.code);
      currentPrompt = item.prompt;
      favoriteBtn.classList.add('active');
      showNotification('⭐ Loaded favorite', 'success');
    }

    function removeFavorite(index) {
      favorites.splice(index, 1);
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateFavoritesDisplay();
      showNotification('🗑️ Favorite removed', 'info');
    }

    // Theme Management
    function toggleTheme() {
      const body = document.body;
      const themeBtn = document.querySelector('.theme-toggle');
      if (body.getAttribute('data-theme') === 'dark') {
        body.setAttribute('data-theme', 'light');
        themeBtn.textContent = '☀️';
        localStorage.setItem('theme', 'light');
      } else {
        body.setAttribute('data-theme', 'dark');
        themeBtn.textContent = '🌙';
        localStorage.setItem('theme', 'dark');
      }
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    document.querySelector('.theme-toggle').textContent = savedTheme === 'dark' ? '🌙' : '☀️';

    // Sidebar Management
    function toggleSidebar() {
      sidebar.classList.toggle('collapsed');
    }

    // Enhanced Notifications
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, 4000);
    }

    // Modal Management
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    function showModal(modalId) {
      if (modalId === 'historyModal') {
        updateHistoryDisplay();
      }
      document.getElementById(modalId).style.display = 'flex';
    }

    // Enhanced Progress Bar
    function showProgress() {
      progressBar.style.display = 'block';
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 10 + 5;
        if (progress > 90) progress = 90;
        progressFill.style.width = progress + '%';
      }, 300);
      return interval;
    }

    function hideProgress(interval) {
      clearInterval(interval);
      progressFill.style.width = '100%';
      setTimeout(() => {
        progressBar.style.display = 'none';
        progressFill.style.width = '0%';
      }, 800);
    }

    const updateStatus = (msg, isError = false) => {
      status.innerHTML = msg;
      status.style.color = isError ? "var(--error)" : "var(--text-secondary)";
    };

    const containsKeyword = (text, keywords) =>
      keywords.some(k => text.toLowerCase().includes(k));

    // Enhanced Generation Function
    const generateGame = async () => {
      const userPrompt = promptInput.value.trim();
      const selectedMode = modeSelect.value;
      const selectedCreativity = creativitySelect.value;
      
      if (!userPrompt) {
        showNotification('⚠️ Please enter a project description', 'error');
        return;
      }

      currentPrompt = userPrompt;
      favoriteBtn.classList.remove('active');

      // Check if current prompt is in favorites
      if (favorites.some(f => f.prompt === userPrompt)) {
        favoriteBtn.classList.add('active');
      }

      let wantsAI = includeAI.checked;
      const mentionsAI = containsKeyword(userPrompt, AI_KEYWORDS);
      const mentionsChatbot = containsKeyword(userPrompt, CHATBOT_KEYWORDS);
      const mentionsInternet = containsKeyword(userPrompt, INTERNET_KEYWORDS);

      if (mentionsInternet) {
        updateStatus("🌐 Detected internet request — launching embedded browser...");
        embedBrowser();
        currentPrompt = null;
        return;
      }

      if (mentionsChatbot) {
        wantsAI = true;
        includeAI.checked = true;
        updateStatus("🤖 Chatbot detected - integrating Pollinations AI...");
      } else if (mentionsAI) {
        wantsAI = true;
        includeAI.checked = true;
        updateStatus("🤖 AI features detected and enabled...");
      } else {
        updateStatus(`🚀 Creating your ${selectedMode}... <span class="loading-animation"></span>`);
      }

      generateBtn.disabled = true;
      generateBtn.innerHTML = '<span class="loading-animation"></span> Generating...';
      resetBtn.disabled = true;
      downloadBtn.disabled = true;
      shareBtn.disabled = true;

      const progressInterval = showProgress();

      // Professional quality baseline - all projects are now professional grade
      const professionalInstructions = "Build production-ready code with best practices, error handling, performance optimizations, accessibility features, and professional UI/UX design. Use modern JavaScript ES6+ features, responsive design principles, and clean code architecture.";

      // Enhanced prompt engineering based on creativity level
      let creativityInstructions = "";
      switch(selectedCreativity) {
        case "typical":
          creativityInstructions = "Create a well-executed, polished version of this classic concept. Focus on perfecting the fundamentals with excellent execution, smooth gameplay, and refined user experience. Use proven design patterns and familiar mechanics that users expect.";
          break;
        case "creative":
          creativityInstructions = "Add creative twists and unique features to make this stand out. Include innovative mechanics, creative visual elements, and interesting gameplay variations while maintaining core functionality. Think outside the box but keep it accessible.";
          break;
        case "innovative":
          creativityInstructions = "Create something completely original and never-before-seen. Invent new mechanics, unique interaction patterns, and revolutionary features. Push the boundaries of what's possible with creative algorithms, novel user interfaces, and groundbreaking concepts.";
          break;
        case "experimental":
          creativityInstructions = "Go completely wild and experimental. Create bizarre, unconventional, and mind-bending experiences. Use abstract concepts, surreal mechanics, and avant-garde design. Break all conventional rules and create something truly unique and unexpected.";
          break;
      }

      let basePrompt = `Create a professional-grade, high-quality ${selectedMode} using modern HTML5, CSS3, and JavaScript. ${professionalInstructions} ${creativityInstructions}`;

      // Special handling for chatbot projects
      if (mentionsChatbot) {
        basePrompt += ` IMPORTANT: This is a chatbot project. You MUST integrate with Pollinations AI API at https://text.pollinations.ai/ for all AI chat responses. 
        
        Implementation Requirements:
        - Create a clean chat interface with message bubbles for user and AI
        - Use fetch() to call https://text.pollinations.ai/ with user messages
        - Handle the API response and display AI replies in the chat
        - Add typing indicators and smooth message animations
        - Include error handling for API failures
        - Make the chat responsive and mobile-friendly
        
        Example API usage:
        const response = await fetch('https://text.pollinations.ai/' + encodeURIComponent(userMessage));
        const aiReply = await response.text();
        
        Focus on creating an engaging conversational experience with the Pollinations AI as the backend.`;
      }
      // Mode-specific enhancements
      else if (selectedMode === "game") {
        basePrompt += wantsAI
          ? " Include intelligent AI opponents or NPCs with decision-making capabilities. Add smooth animations, particle effects, and immersive gameplay mechanics."
          : " Focus on engaging gameplay mechanics, smooth animations, visual effects, sound feedback, and polished user experience.";
        basePrompt += " Include proper game loops, collision detection, scoring systems, and responsive controls.";
      } else if (selectedMode === "website") {
        basePrompt += wantsAI
          ? " Integrate an intelligent chatbot or virtual assistant with natural language processing capabilities."
          : " Focus on modern web design with responsive layouts, smooth animations, and excellent user experience.";
        basePrompt += " Use modern CSS features like flexbox/grid, smooth scrolling, hover effects, and mobile-first design.";
      } else if (selectedMode === "app") {
        basePrompt += wantsAI
          ? " Include smart features like recommendation systems, predictive text, or intelligent data analysis."
          : " Create a single-page application with modern UI components and smooth interactions.";
        basePrompt += " Include state management, data persistence, form validation, and professional styling.";
      } else if (selectedMode === "tool") {
        basePrompt += wantsAI
          ? " Add intelligent automation, smart suggestions, or AI-powered analysis features."
          : " Focus on utility and efficiency with clean, professional interface design.";
        basePrompt += " Include input validation, error handling, export functionality, and helpful user guidance.";
      }

      basePrompt += ` Make it visually appealing with modern design trends, gradients, shadows, and smooth transitions. All code must be in a single, complete HTML file with embedded CSS and JavaScript. No external dependencies. Generate only clean, working code without any comments, explanations, or chat responses. User request: "${userPrompt}"`;

      try {
        const url = "https://text.pollinations.ai/" + encodeURIComponent(`CRITICAL: Return ONLY executable HTML code. NO explanations, NO comments, NO descriptions, NO text outside code. Start with <!DOCTYPE html> and end with </html>. ${basePrompt}`);
        const res = await fetch(url, {
          method: 'GET',
          headers: {
            'Accept': 'text/html,text/plain',
          }
        });
        
        if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        
        let code = await res.text();
        
        // Enhanced comment and explanation filtering
        code = filterCodeComments(code);
        
        if (!code || code.length < 100) {
          throw new Error("Generated code is too short or empty");
        }
        
        showGame(code.trim());
        updateStatus(`✅ Your ${selectedMode} is ready! 🎉`);
        showNotification('🎯 Creation complete!', 'success');
        
      } catch (err) {
        console.error('Generation error:', err);
        updateStatus("❌ Something went wrong. Please try again with a different idea.", true);
        showNotification('🔄 Try again with a different idea', 'error');
      } finally {
        generateBtn.disabled = false;
        generateBtn.innerHTML = '✨ Create It!';
        hideProgress(progressInterval);
      }
    };

    // Enhanced Sharing
    function generateShareLink() {
      if (!lastGeneratedCode) return '';
      const data = {
        prompt: currentPrompt,
        code: lastGeneratedCode,
        mode: modeSelect.value,
        creativity: creativitySelect.value,
        timestamp: Date.now()
      };
      return window.location.origin + '?shared=' + btoa(JSON.stringify(data));
    }

    function copyShareLink() {
      const shareInput = document.getElementById('shareInput');
      shareInput.select();
      document.execCommand('copy');
      showNotification('📋 Link copied to clipboard', 'success');
    }

    // Load shared content
    function loadSharedContent() {
      const urlParams = new URLSearchParams(window.location.search);
      const shared = urlParams.get('shared');
      if (shared) {
        try {
          const data = JSON.parse(atob(shared));
          promptInput.value = data.prompt;
          modeSelect.value = data.mode;
          creativitySelect.value = data.creativity || 'creative';
          showGame(data.code);
          currentPrompt = data.prompt;
          showNotification('🔗 Shared project loaded', 'success');
        } catch (e) {
          showNotification('❌ Invalid share link', 'error');
        }
      }
    }

    function setSuggestion(suggestion) {
      promptInput.value = suggestion;
      promptInput.focus();
      showNotification('💡 Suggestion added! Click "Create It!" to generate', 'info');
    }

    // Bulk operations
    function exportAllProjects() {
      if (savedProjects.length === 0) {
        showNotification('❌ No projects to export', 'error');
        return;
      }
      
      const exportData = {
        projects: savedProjects,
        exportDate: new Date().toISOString(),
        version: '1.0'
      };
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ai-projects-export-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification('📤 Projects exported successfully', 'success');
    }

    function importProjects() {
      document.getElementById('importFileInput').click();
    }

    function clearAllProjects() {
      if (confirm('Are you sure you want to delete ALL saved projects? This cannot be undone.')) {
        savedProjects = [];
        localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
        updateSavedProjectsDisplay();
        showNotification('🗑️ All projects cleared', 'info');
      }
    }

    // Event Listeners
    generateBtn.addEventListener("click", generateGame);
    
    promptInput.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        generateGame();
      }
    });

    resetBtn.addEventListener("click", () => {
      if (lastGeneratedCode) {
        updateStatus("🔄 Resetting to last generation...");
        showGame(lastGeneratedCode);
        showNotification('🔄 Reset complete', 'info');
      }
    });

    downloadBtn.addEventListener("click", () => {
      if (!lastGeneratedCode) return;
      const blob = new Blob([lastGeneratedCode], {type: "text/html"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `ai-${modeSelect.value}-${creativitySelect.value}-${Date.now()}.html`;
      a.click();
      updateStatus("📦 Downloaded generated file successfully!");
      showNotification('📥 File downloaded', 'success');
    });

    favoriteBtn.addEventListener("click", toggleFavorite);

    // Project management event listeners
    document.getElementById('saveProjectBtn').addEventListener('click', () => {
      if (!lastGeneratedCode) {
        showNotification('❌ No project to save', 'error');
        return;
      }
      document.getElementById('projectNameInput').value = '';
      updateSavedProjectsDisplay();
      document.getElementById('projectModal').style.display = 'flex';
    });

    document.getElementById('loadProjectBtn').addEventListener('click', () => {
      updateSavedProjectsDisplay();
      document.getElementById('projectModal').style.display = 'flex';
    });

    // File import handler
    document.getElementById('importFileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const importData = JSON.parse(event.target.result);
          if (importData.projects && Array.isArray(importData.projects)) {
            // Merge with existing projects, avoiding duplicates
            importData.projects.forEach(project => {
              if (!savedProjects.find(p => p.name === project.name)) {
                project.id = Date.now() + Math.random(); // Ensure unique ID
                savedProjects.push(project);
              }
            });
            localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
            updateSavedProjectsDisplay();
            showNotification(`📥 Imported ${importData.projects.length} projects`, 'success');
          }
        } catch (error) {
          showNotification('❌ Invalid import file', 'error');
        }
      };
      reader.readAsText(file);
      e.target.value = ''; // Reset file input
    });

    shareBtn.addEventListener("click", () => {
      const shareLink = generateShareLink();
      document.getElementById('shareInput').value = shareLink;
      document.getElementById('shareModal').style.display = 'flex';
    });

    // Enhanced Keyboard Shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'Enter':
            e.preventDefault();
            if (!generateBtn.disabled) generateGame();
            break;
          case 'r':
            e.preventDefault();
            if (!resetBtn.disabled) resetBtn.click();
            break;
          case 'd':
            e.preventDefault();
            if (!downloadBtn.disabled) downloadBtn.click();
            break;
          case 'b':
            e.preventDefault();
            toggleSidebar();
            break;
          case 's':
            e.preventDefault();
            if (e.shiftKey) {
              if (!document.getElementById('saveProjectBtn').disabled) {
                document.getElementById('saveProjectBtn').click();
              }
            } else {
              if (!shareBtn.disabled) shareBtn.click();
            }
            break;
          case 'o':
            e.preventDefault();
            document.getElementById('loadProjectBtn').click();
            break;
        }
      }
      
      // ESC to close modals
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal').forEach(modal => {
          modal.style.display = 'none';
        });
      }
    });

    // Save project with Enter key in modal
    document.getElementById('projectNameInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        saveCurrentProject();
      }
    });

    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
      }
    });

    // Initialize
    updateFavoritesDisplay();
    updateHistoryDisplay();
    updateSavedProjectsDisplay();
    loadSharedContent();
    
    // Welcome message with enhanced features
    setTimeout(() => {
      showNotification('🎯 Enhanced AI Generator ready! Auto-responsive design & professional UI!', 'info');
    }, 1000);

    // Auto-adjust on window resize
    window.addEventListener('resize', () => {
      const iframe = previewContainer.querySelector('iframe');
      if (iframe) {
        const viewport = getOptimalViewport();
        iframe.style.width = viewport.width;
        iframe.style.maxWidth = viewport.maxWidth;
      }
    });
  </script>

</body>

</html>
